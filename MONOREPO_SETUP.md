# Oppijan Korp Monorepo Setup

This project now supports building both a standalone React app and a WordPress plugin from a single codebase.

## Project Structure

```
oppijan-korp/
├── src/                      # React source code
│   ├── config/
│   │   └── index.ts         # Environment-based configuration
│   ├── main.tsx             # Entry point (now uses dynamic mount ID)
│   └── App.tsx              # Main app component
├── wordpress-plugin/         # WordPress plugin directory
│   ├── oppijan-korp.php     # WordPress plugin file
│   ├── dist/                # Built files (generated by build:wordpress)
│   └── README.md            # Plugin installation instructions
├── .env.production          # Standalone app configuration
├── .env.wordpress           # WordPress plugin configuration
├── vite.config.ts           # Updated with mode-based builds
└── package.json             # Added build:wordpress script
```

## Environment Configuration

### Standalone App (`.env.production`)
```env
VITE_MOUNT_ELEMENT_ID=root
VITE_APP_TITLE=Oppijan Korp
VITE_IS_WORDPRESS=false
```

### WordPress Plugin (`.env.wordpress`)
```env
VITE_MOUNT_ELEMENT_ID=oppijan-korp-app
VITE_APP_TITLE=Oppijan Korp
VITE_IS_WORDPRESS=true
```

## Build Commands

### Standalone React App
```bash
npm run build
# Outputs to: dist/
```

### WordPress Plugin
```bash
npm run build:wordpress
# Outputs to: wordpress-plugin/dist/
```

### Development
```bash
npm run dev                    # Run standalone version in dev mode
npm run preview:wordpress      # Preview WordPress build locally
```

## Key Changes Made

1. **Dynamic Mount Element ID**: [src/main.tsx:7](src/main.tsx#L7)
   - Now reads from `config.mountElementId` instead of hardcoded `'root'`

2. **Environment Config Module**: [src/config/index.ts](src/config/index.ts)
   - Centralizes all environment-based settings
   - Accessible throughout the app via `import { config } from './config'`

3. **Mode-Based Vite Config**: [vite.config.ts:6](vite.config.ts#L6)
   - Detects build mode and adjusts output directory
   - Sets correct base path for WordPress assets

4. **WordPress Plugin File**: [wordpress-plugin/oppijan-korp.php](wordpress-plugin/oppijan-korp.php)
   - Loads built assets from `dist/` using Vite manifest
   - Creates `<div id="oppijan-korp-app"></div>` matching the env config

## How to Deploy WordPress Plugin

### Option 1: Manual Copy
```bash
# Build the WordPress version
npm run build:wordpress

# Copy to WordPress plugins directory
cp -r wordpress-plugin /path/to/wordpress/wp-content/plugins/oppijan-korp

# Activate in WordPress admin and use [oppijan-korp] shortcode
```

### Option 2: Automated CI/CD (Coming Next)
We'll set up GitHub Actions to automatically deploy to your WordPress server.

## Adding More WordPress-Specific Customization

You can add more environment variables to `.env.wordpress` for:
- Custom styling (colors, fonts)
- Different text content
- WordPress-specific features
- API endpoints

Example:
```env
# .env.wordpress
VITE_PRIMARY_COLOR=#0073aa
VITE_SHOW_FOOTER=false
VITE_API_ENDPOINT=/wp-json/custom/v1
```

Then use in your code:
```typescript
// src/config/index.ts
export const config = {
  // ... existing config
  theme: {
    primaryColor: import.meta.env.VITE_PRIMARY_COLOR || '#007bff',
  },
  showFooter: import.meta.env.VITE_SHOW_FOOTER !== 'false',
  apiEndpoint: import.meta.env.VITE_API_ENDPOINT || '/api',
}
```

## Next Steps

1. ✅ Monorepo structure is complete
2. ⏳ Set up CI/CD pipeline for automated deployment
3. ⏳ Configure deployment to your WordPress server

## Testing

Test that both builds work correctly:

```bash
# Build both versions
npm run build              # Standalone
npm run build:wordpress    # WordPress

# Verify standalone uses #root
# Verify WordPress uses #oppijan-korp-app
```
